<!DOCTYPE html>
<html>
<head>
	<title>Mapping Laws</title>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="lib/leaflet.css" />
	<link rel="stylesheet" href="lib/map.css" />
</head>
<body>
	<div id="map"></div>
</body>
<script>
	var host = "watershedlegal.github.io";
	if ((host == window.location.host) && (window.location.protocol != "https:"))
	    window.location = window.location.toString().replace(/^http:/, "https:");
</script>
<script src="lib/leaflet.js"></script>
<script src="lib/colorschemes.js"></script>
<script src="countries_geo_data.js"></script>
<script src="countries_data.js"></script>
<script type="text/javascript">

	var geojson;

	var title = 'Mapping Laws'

	// First, load and merge the data from the data files
	function mergeData( obj1, obj2 ) {
	    for ( var i in obj2 ) {
	        obj1[i] = obj2[i];
	    }
	    return obj1;
	};

	countries.features.forEach( function(e,i){ mergeData(e.properties, countriesData.features[i].properties) });

	// Now, set the map to a world view ... sorry for the offset Souther Hemisphere lovers
	var map = new L.Map('map');
	var osmUrl='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
	var osmAttrib='Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a>';
	var osm = new L.TileLayer(osmUrl, {minZoom: 3, maxZoom: 8, attribution: osmAttrib});

	map.setView([25, 0], 3);
	map.addLayer(osm);

	// Next, set the styles & UX Components
	function countryStyle(feature) {
    return {
        fillColor: getColor(feature.properties.rank),
        weight: 2,
        opacity: 1,
        color: 'F0F9E8',
        dashArray: '3',
        fillOpacity: 0.5
    };
	}

	function getColor(d) {
	    return blueGreen(d);
	}

	function popup(feature, layer) {
	    if (feature.properties && feature.properties.name) {
	        layer.bindPopup(feature.properties.name);
	    }
	};

	function highlightFeature(e) {
	    var layer = e.target;

	    layer.setStyle({
	        weight: 2,
	        color: getColor('border'),
	        dashArray: '',
	        fillOpacity: 0.8
	    });

	    if (!L.Browser.ie && !L.Browser.opera) {
	        layer.bringToFront();
	    }
	    info.update(layer.feature.properties);
	}

	function resetHighlight(e) {
	    geojson.resetStyle(e.target);
	    info.update();
	}

	function zoomToFeature(e) {
	    map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
	    layer.on({
	        mouseover: highlightFeature,
	        mouseout: resetHighlight,
	        click: zoomToFeature
	    });
	}

	var mapData = {
	    // onEachFeature: popup,
	    style: countryStyle,
	    onEachFeature: onEachFeature
	};

	// Run the Map
	geojson = L.geoJson(countries, mapData).addTo(map);

	// Add the Legend
	var legend = L.control({position: 'bottomright'});

	legend.onAdd = function (map) {

	    var div = L.DomUtil.create('div', 'info legend'),
	        grades = [1, 2, 3, 4, 5],
	        labels = [];

	    // loop through our density intervals and generate a label with a colored square for each interval
	    for (var i = 0; i < grades.length; i++) {
	        div.innerHTML += '<i style="background:' + getColor(grades[i]) + '"></i> ' + grades[i] + '<br>';
	    }

	    return div;
	};

	legend.addTo(map);

	// Add the Information Box
	var info = L.control({position: 'bottomleft'});

	info.onAdd = function (map) {
	    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
	    this.update();
	    return this._div;
	};

	// method that we will use to update the control based on feature properties passed
	info.update = function (props) {
	    this._div.innerHTML = '<h4>' + title + '</h4>' +  (props ?
	        '<b>' + props.name + '</b><br />' + props.synopsis: '');
	};

	info.addTo(map);
</script>
</html>
